\section{bunsan::worker}
\label{bunsanworker}
Для распределения нагрузки в гетерогенной среде
был разработан проект \textit{bunsan::worker}.

\subsection{Гетерогенная среда}
Данный проект предназначен для выполнения заданий
с применением различных программных сред, операционных систем и платформ.
Задание представляет из себя массив байт, который необходимо
интерпретировать определённым образом,
соответствующим данному типу задания. Интерпретатором является
программа, специфичная для платформы, на которой
происходит запуск.

Так как может существовать множество различных
типов платформ, то наиболее надёжным является создание своей копии
интерпретатора на каждой платформе.
Самый простой способ это сделать -- произвести сборку
интерпретатора перед его использованием.
Так как компилировать результат сборки интерпретатора повторяем,
имеет смысл его кэшировать.
За это отвечает \textit{Пакетный менеджер} \ref{bunsanpm}.

Данный проект эффективен,
если время выполнения одного задания много больше
времени передачи самого задания по сети,
а также передачи результата.

На уровне \textit{bunsan::worker} задание
представляется как массив байт. Система
не предоставляет возможности отправить результат
обратно, предполагается, что в зависимости
от типа задания эффективными могут быть различные методы передачи результата.
Тем не менее система пересылает уведомления о ходе выполнения задания.

\subsection{Типы уведомлений}
\begin{itemize}
    \item RECEIVED -- задание получено и помещено в очередь на выполнение;
    \item STARTED -- начата обработка задания;
    \item EXTRACTING -- происходит извлечение пакета для выполнения задания;
    \item EXTRACTED -- пакет извлечён, переход к запуску задания;
    \item DONE -- задание выполнено успешно;
    \item FAIL -- произошла ошибка,
        в качестве дополнительных параметров могут быть переданные дополнительные данные,
        связанные с ошибкой.
\end{itemize}

\subsection{Интерфейс bunsan::worker}
Процесс bunsan::worker предоставляет RPC функцию add\_task,
которой передаются три аргумента:
\begin{enumerate}
    \item callback -- настройки обратного вызова,
        адрес для передачи информации о запуске задания;
    \item package -- идентификатор пакета,
        который содержит интерпретатор задания;
    \item process -- настройки запуска интерпретатора.
\end{enumerate}

\subsubsection{Callback}
Callback задаётся при помощи
\begin{enumerate}
    \item протокола;
    \item списка аргументов, интерпретация которых зависит
        от реализации данного протокола.
\end{enumerate}

\paragraph{XMLRPC} реализация список аргументов интерпретирует как
\begin{enumerate}
    \item URL -- адрес сервиса, который обрабатывает вызов;
    \item method -- название удалённой функции;
    \item дополнительные аргументы, которые будут подставлены
        перед аргументами, передаваемыми bunsan::worker'ом.
        Эти аргументы необходимы в первую очередь
        сервису для того, чтобы определить,
        о каком задании идёт речь в данном RPC.
\end{enumerate}

\subsubsection{Package}
Имя пакета, строка. Передаётся \textit{Пакетному менеджеру} \ref{bunsanpm} без изменений.

\subsubsection{Process}
Структура, содержащая два поля:
\begin{itemize}
    \item \textbf{arguments} -- список аргументов для запуска,
        при этом первый аргумент -- путь до интерпретатора
        внутри пакета;
    \item \textbf{stdin\_data} -- массив байт, который будет передан
        интерпретатору на STDIN.
\end{itemize}
