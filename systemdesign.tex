\chapter{Основные компоненты, архитектура}

\section{Взаимодействие}
Система представляет из себя комплекс взаимодействующих сервисов.
Основные группы представлены на рис.~\ref{fig:systemdesign}.

\begin{figure}
    \centering
    \includegraphics{rs/systemdesign}
    \caption{Архитектура}
    \label{fig:systemdesign}
\end{figure}

\subsection{Пользовательский интерфейс, frontend}
Точкой входа в систему для пользователя является веб-интерфейс.
Данный сервис 
\begin{itemize}
    \item контролирует права доступа пользователей;
    \item отображает информацию об имеющихся задачах;
    \item контролирует проведение соревнований;
    \item пересылает решения пользователей на backend;
    \item отображает результаты.
\end{itemize}

Отдельным сайтом является интерфейс для администраторов.
Он предоставляет возможность
\begin{itemize}
    \item создавать и редактировать контесты;
    \item модифицировать архив задач;
    \item модифицировать права пользователей.
\end{itemize}

Данный компонент является внешним по отношению к представленной системе.

\subsection{Тестирующая система}
Данный компонент реализует тестирование решений участников соревнований.
Для проверки решения требуются тесты, вспомогательные утилиты для запуска решений,
сравнения результатов с требуемыми, условия задач для участников,
механизмы контроля качества задач.

\subsection{Система распределения нагрузки}
Данный компонент необходим для масштабирования системы.
При высокой нагрузке требуется проводить тестирование решений параллельно.
Для этого необходим пул обработчиков, каждый из которых регистрируется в специально
созданном для этого менеджере для последующего использования frontend'ом.

\section{Архив задач}
Для того, чтобы создать контест необходимы задачи.
При работе с задачами выделяется роль ответственного за данную задачу (может включать в себя
несколько человек) -- maintainer. Он закачивает задачу в \textit{Архив} при помощи WEB-интерфейса,
контролирующего права доступа к архиву. Архив преобразует задачу во внутренний формат,
подходящий для автоматической обработки решений по данной задаче, а также позволяет
\textit{WEB-интерфейсу} получать подробную информацию о данной задаче:
название, авторы, настройки проверки решений, объём тестов и прочее.

\textit{Архив} также помещает задачу, преобразованную во внутренний формат, в \textit{Репозиторий}.

\section{Репозиторий}
\textit{Репозиторий} представляет из себя хранилище последних версий исходных кодов
программы тестирования решений, задач, вспомогательных библиотек.
\textit{Репозиторий} используется библиотекой пакетного менеджера,
которая отслеживает обновления исходных кодов и в случае необходимости
обновляет закэшированные локальные копии данных.

\section{Сервис условий}
BACS поддерживает различные форматы условий, в том числе и те, которые необходимо
конвертировать в другой формат, к примеру LaTeX в PDF. Для этого используется
\textit{Сервис условий}, который при помощи пакетного менеджера загружает последнюю
версию условия из репозитория, конвертирует при необходимости,
и отправляет пользователю. \textit{WEB-интерфейс} формирует специальную ссылку
для каждой задачи, используя которую \textit{Сервис условий} определяет
какой пакет из \textit{Репозитория} необходимо использовать.

\section{Обработчик}
Для проверки решений используются специально выделенные компьютеры (или виртуальные машины),
на которых запускается процесс обработчика заданий.
\textit{WEB-интерфейс} пересылает пользовательские решения обработчику, указывая пакет,
в котором находятся исходные коды задачи и \textit{тестера}, соответствующего
настройкам проверки. Обработчик передаёт решение \textit{тестеру}, который
после проверки решения отправляет результат на \textit{WEB-интерфейс} по указанному адресу.

\section{Контроллер ресурсов}
Для контроля множества обработчиков используется специальный сервис -- \textit{Контроллер ресурсов}.
В нём регистрируются дублирующиеся в сети ресурсы, к примеру, \textit{Обработчики}.
Процесс, которому требуется определённый ресурс, обращается к контроллеру,
указывая известный идентификатор данного ресурса,
контроллер возвращает адрес, куда следует обращаться для доступа к нужному сервису.
К примеру, \textit{Обработчик} регистрируется с идентификатором \textbf{bacs-slave},
\textit{WEB-интерфейс} посылает запрос на получение ресурса с таким идентификатором,
и получает URI одного из доступных \textit{Обработчиков}.

Алгоритм выбора одного из имеющихся обработчиков предполагает
стратегию выбора наименее нагруженного для балансировки нагрузки.
